#version 330 core

in vec2 v_uv;
in vec4 v_color;

uniform sampler2D u_texture;   // без layout(binding)
out vec4 f_color;

void main() {
    // Для пиксель-в-пиксель рендеринга шрифтов:
    // Текстура имеет белые буквы на черном фоне (или прозрачном фоне)
    vec4 t = texture(u_texture, v_uv);
    
    // Если альфа-канал реально используется (не везде 1.0), используем его
    // Иначе используем яркость как альфу: белое = непрозрачно, черное = прозрачно
    float a;
    if (t.a < 0.99) {
        // Есть реальный альфа-канал - используем его
        a = t.a;
    } else {
        // Альфа везде 1.0 - используем яркость как альфу
        // Белые буквы (RGB=1.0) → альфа=1.0 (непрозрачно)
        // Черный фон (RGB=0.0) → альфа=0.0 (прозрачно)
        a = (t.r + t.g + t.b) / 3.0;
    }
    
    f_color = v_color * vec4(1.0, 1.0, 1.0, a);
}
